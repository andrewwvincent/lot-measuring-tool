<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Campus Area Analyzer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 350px;
            padding: 20px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            z-index: 1000;
        }
        
        .map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 15px;
            margin: -20px -20px 20px -20px;
            text-align: center;
        }
        
        .search-section {
            margin-bottom: 20px;
        }
        
        .search-section input {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        
        .search-section button {
            width: 100%;
            padding: 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .address-list select {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 20px;
        }
        
        .tools-section {
            margin-bottom: 20px;
        }
        
        .tool-button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .tool-boundary { background: #f39c12; color: white; }
        .tool-building { background: #e74c3c; color: white; }
        .tool-field { background: #27ae60; color: white; }
        .tool-parking { background: #95a5a6; color: white; }
        .tool-outdoor { background: #9b59b6; color: white; }
        
        .tool-button.active {
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transform: scale(1.05);
        }
        
        .stats-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-radius: 3px;
        }
        
        .controls-section button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #34495e;
            color: white;
        }
        
        .view-controls {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .toggle-button {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #3498db;
            color: white;
            font-size: 14px;
        }
        
        .toggle-button.active {
            background: #27ae60;
        }
        
        .message {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .success {
            color: #27ae60;
            background: #d5f4e6;
        }
        
        .error {
            color: #e74c3c;
            background: #fadbd8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="header">
                <h2>üó∫Ô∏è Maps Campus Analyzer</h2>
                <p>Draw on Google Maps for precise measurements</p>
            </div>
            
            <!-- Search Section -->
            <div class="search-section">
                <h3>üìç Search Location</h3>
                <input type="text" id="addressSearch" placeholder="Enter school address">
                <button onclick="searchAddress()">Load on Map</button>
                
                <select id="addressSelect" onchange="selectFromList()">
                    <option value="">Select from Austin schools...</option>
                </select>
            </div>
            
            <!-- View Controls -->
            <div class="view-controls">
                <h3>üìê View Settings</h3>
                <p style="font-size: 12px; margin: 5px 0; color: #666;">Control satellite view angle for precise measurements:</p>
                <button id="topDownBtn" class="toggle-button active" onclick="toggleTopDown()">
                    üì° Top-Down View (Recommended)
                </button>
                <button id="angledBtn" class="toggle-button" onclick="toggleAngled()">
                    üè¢ 45¬∞ Angled View
                </button>
            </div>
            
            <!-- Drawing Tools -->
            <div class="tools-section">
                <h3>üé® Drawing Tools</h3>
                <button class="tool-button tool-boundary" onclick="setTool('boundary')">
                    üè´ School Boundary
                </button>
                <button class="tool-button tool-building" onclick="setTool('building')">
                    üè¢ Buildings
                </button>
                <button class="tool-button tool-field" onclick="setTool('field')">
                    üèÉ Playing Fields
                </button>
                <button class="tool-button tool-parking" onclick="setTool('parking')">
                    üöó Parking
                </button>
                <button class="tool-button tool-outdoor" onclick="setTool('outdoor')">
                    üå≥ Outdoor Space
                </button>
            </div>
            
            <!-- Statistics -->
            <div class="stats-section">
                <h3>üìä Area Summary</h3>
                <div class="stat-item">
                    <span>School Boundary:</span>
                    <span id="boundaryAcres">0.0 acres (0 ft¬≤)</span>
                </div>
                <div class="stat-item">
                    <span>Buildings:</span>
                    <span id="buildingAcres">0.0 acres (0 ft¬≤)</span>
                </div>
                <div class="stat-item">
                    <span>Playing Fields:</span>
                    <span id="fieldAcres">0.0 acres (0 ft¬≤)</span>
                </div>
                <div class="stat-item">
                    <span>Parking:</span>
                    <span id="parkingAcres">0.0 acres (0 ft¬≤)</span>
                </div>
                <div class="stat-item">
                    <span>Outdoor Space:</span>
                    <span id="outdoorAcres">0.0 acres (0 ft¬≤)</span>
                </div>
                <div class="stat-item">
                    <span>Field Utilization:</span>
                    <span id="fieldUtilization">0.0%</span>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="controls-section">
                <button onclick="clearLastArea()">üóëÔ∏è Clear Last</button>
                <button onclick="clearAllAreas()">üóëÔ∏è Clear All</button>
                <button onclick="exportResults()">üìä Export Results</button>
            </div>
            
            <div id="messageArea"></div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
        </div>
    </div>

    <script>
        let map;
        let geocoder;
        let currentTool = null;
        let drawnAreas = [];
        let isDrawing = false;
        let currentPath = [];
        let tempMarkers = [];
        let isTopDownMode = true;
        
        // Area colors
        const areaColors = {
            'boundary': '#f39c12',
            'building': '#e74c3c', 
            'field': '#27ae60',
            'parking': '#95a5a6',
            'outdoor': '#9b59b6'
        };
        
        // Austin school addresses
        const austinSchools = [
            "Austin High School, 1715 W Cesar Chavez St, Austin, TX 78703",
            "Bowie High School, 4103 W Slaughter Ln, Austin, TX 78749", 
            "McCallum High School, 5600 Sunshine Dr, Austin, TX 78756",
            "Anderson High School, 8403 Mesa Dr, Austin, TX 78759",
            "Eastside Memorial High School, 1012 Arthur Stiles Rd, Austin, TX 78721",
            "LASA High School, 7309 Lazy Creek Dr, Austin, TX 78724",
            "Akins High School, 10701 S 1st St, Austin, TX 78748",
            "Crockett High School, 5601 Manchaca Rd, Austin, TX 78745",
            "Lanier High School, 1201 Payton Gin Rd, Austin, TX 78758",
            "Reagan High School, 7104 Berkman Dr, Austin, TX 78752"
        ];
        
        function initMap() {
            // Initialize map centered on Austin
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,
                center: { lat: 30.2672, lng: -97.7431 },
                mapTypeId: 'satellite',
                tilt: 0, // Start with top-down view
                rotateControl: false // Disable rotation for consistent measurements
            });
            
            // Initialize geocoder
            geocoder = new google.maps.Geocoder();
            
            // Add click listener for drawing
            map.addListener('click', function(event) {
                if (currentTool && isDrawing) {
                    addPointToPath(event.latLng);
                }
            });
            
            // Add double-click listener to complete polygon
            map.addListener('dblclick', function(event) {
                if (currentTool && isDrawing && currentPath.length >= 3) {
                    completePolygon();
                }
            });
            
            // Maintain tilt setting when zooming
            map.addListener('zoom_changed', function() {
                if (isTopDownMode) {
                    map.setTilt(0);
                }
            });
            
            // Load school addresses
            loadSchoolAddresses();
            
            showMessage('Google Maps loaded successfully! Select a drawing tool to start.', 'success');
        }
        
        function toggleTopDown() {
            isTopDownMode = true;
            map.setTilt(0);
            
            // Update button states
            document.getElementById('topDownBtn').classList.add('active');
            document.getElementById('angledBtn').classList.remove('active');
            
            showMessage('Switched to top-down view - best for accurate measurements', 'success');
        }
        
        function toggleAngled() {
            isTopDownMode = false;
            map.setTilt(45);
            
            // Update button states
            document.getElementById('angledBtn').classList.add('active');
            document.getElementById('topDownBtn').classList.remove('active');
            
            showMessage('Switched to 45¬∞ angled view - shows building heights', 'success');
        }
        
        function loadSchoolAddresses() {
            const select = document.getElementById('addressSelect');
            austinSchools.forEach(school => {
                const option = document.createElement('option');
                option.value = school;
                option.textContent = school;
                select.appendChild(option);
            });
        }
        
        function searchAddress() {
            const address = document.getElementById('addressSearch').value.trim();
            if (!address) {
                showMessage('Please enter an address', 'error');
                return;
            }
            loadAddressOnMap(address);
        }
        
        function selectFromList() {
            const address = document.getElementById('addressSelect').value;
            if (address) {
                document.getElementById('addressSearch').value = address;
                loadAddressOnMap(address);
            }
        }
        
        function loadAddressOnMap(address) {
            geocoder.geocode({ address: address }, function(results, status) {
                if (status === 'OK') {
                    map.setCenter(results[0].geometry.location);
                    map.setZoom(18);
                    
                    // Add marker
                    new google.maps.Marker({
                        position: results[0].geometry.location,
                        map: map,
                        title: address
                    });
                    
                    showMessage(`Loaded: ${results[0].formatted_address}`, 'success');
                } else {
                    showMessage('Address not found: ' + status, 'error');
                }
            });
        }
        
        function setTool(tool) {
            // Remove active class from all buttons
            document.querySelectorAll('.tool-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to selected tool
            event.target.classList.add('active');
            
            currentTool = tool;
            isDrawing = true;
            currentPath = [];
            clearTempMarkers();
            
            showMessage(`Click on map to draw ${tool} area. Double-click to finish.`, 'success');
        }
        
        function addPointToPath(latLng) {
            currentPath.push(latLng);
            
            // Add temporary marker
            const marker = new google.maps.Marker({
                position: latLng,
                map: map,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 4,
                    fillColor: areaColors[currentTool],
                    fillOpacity: 1,
                    strokeWeight: 1,
                    strokeColor: '#ffffff'
                }
            });
            
            tempMarkers.push(marker);
        }
        
        function completePolygon() {
            if (currentPath.length < 3) {
                showMessage('Need at least 3 points to create an area', 'error');
                return;
            }
            
            // Create polygon
            const polygon = new google.maps.Polygon({
                paths: currentPath,
                fillColor: areaColors[currentTool],
                fillOpacity: 0.3,
                strokeColor: areaColors[currentTool],
                strokeWeight: 2,
                editable: true,
                draggable: false
            });
            
            polygon.setMap(map);
            
            // Calculate area
            const area = google.maps.geometry.spherical.computeArea(polygon.getPath());
            const areaAcres = area * 0.000247105; // Convert m¬≤ to acres
            const areaSqft = area * 10.7639; // Convert m¬≤ to ft¬≤
            
            // Store area data
            const areaData = {
                polygon: polygon,
                type: currentTool,
                area_m2: area,
                area_acres: areaAcres,
                area_sqft: areaSqft
            };
            
            drawnAreas.push(areaData);
            
            // Add edit listener
            polygon.addListener('mouseup', function() {
                updateAreaCalculations();
            });
            
            // Update statistics
            updateStatistics();
            
            // Reset drawing state
            isDrawing = false;
            currentPath = [];
            clearTempMarkers();
            
            showMessage(`Added ${currentTool}: ${areaAcres.toFixed(2)} acres (${Math.round(areaSqft).toLocaleString()} ft¬≤)`, 'success');
        }
        
        function clearTempMarkers() {
            tempMarkers.forEach(marker => marker.setMap(null));
            tempMarkers = [];
        }
        
        function updateAreaCalculations() {
            // Recalculate all areas when polygons are edited
            drawnAreas.forEach(areaData => {
                const area = google.maps.geometry.spherical.computeArea(areaData.polygon.getPath());
                areaData.area_m2 = area;
                areaData.area_acres = area * 0.000247105;
                areaData.area_sqft = area * 10.7639;
            });
            
            updateStatistics();
        }
        
        function updateStatistics() {
            const stats = {
                boundary: 0,
                building: 0,
                field: 0,
                parking: 0,
                outdoor: 0
            };
            
            drawnAreas.forEach(area => {
                if (stats.hasOwnProperty(area.type)) {
                    stats[area.type] += area.area_acres;
                }
            });
            
            // Update display
            document.getElementById('boundaryAcres').textContent = 
                `${stats.boundary.toFixed(2)} acres (${Math.round(stats.boundary * 43560).toLocaleString()} ft¬≤)`;
            document.getElementById('buildingAcres').textContent = 
                `${stats.building.toFixed(2)} acres (${Math.round(stats.building * 43560).toLocaleString()} ft¬≤)`;
            document.getElementById('fieldAcres').textContent = 
                `${stats.field.toFixed(2)} acres (${Math.round(stats.field * 43560).toLocaleString()} ft¬≤)`;
            document.getElementById('parkingAcres').textContent = 
                `${stats.parking.toFixed(2)} acres (${Math.round(stats.parking * 43560).toLocaleString()} ft¬≤)`;
            document.getElementById('outdoorAcres').textContent = 
                `${stats.outdoor.toFixed(2)} acres (${Math.round(stats.outdoor * 43560).toLocaleString()} ft¬≤)`;
            
            // Calculate field utilization
            const totalArea = stats.boundary || (stats.building + stats.field + stats.parking + stats.outdoor);
            const fieldUtilization = totalArea > 0 ? (stats.field / totalArea) * 100 : 0;
            document.getElementById('fieldUtilization').textContent = `${fieldUtilization.toFixed(1)}%`;
        }
        
        function clearLastArea() {
            if (drawnAreas.length > 0) {
                const lastArea = drawnAreas.pop();
                lastArea.polygon.setMap(null);
                updateStatistics();
                showMessage('Cleared last area', 'success');
            } else {
                showMessage('No areas to clear', 'error');
            }
        }
        
        function clearAllAreas() {
            drawnAreas.forEach(area => {
                area.polygon.setMap(null);
            });
            drawnAreas = [];
            updateStatistics();
            showMessage('Cleared all areas', 'success');
        }
        
        function exportResults() {
            if (drawnAreas.length === 0) {
                showMessage('No areas to export', 'error');
                return;
            }
            
            // Create CSV content
            let csv = 'Area Type,Area (Acres),Area (Sq Ft),Coordinates\n';
            
            drawnAreas.forEach(area => {
                const coords = [];
                area.polygon.getPath().forEach(function(coord) {
                    coords.push(`${coord.lat()},${coord.lng()}`);
                });
                const coordString = coords.join(';');
                csv += `${area.type},${area.area_acres.toFixed(4)},${Math.round(area.area_sqft)},${coordString}\n`;
            });
            
            // Download CSV
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `campus_analysis_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showMessage('Results exported successfully!', 'success');
        }
        
        function showMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = `<div class="message ${type}">${message}</div>`;
            
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }
    </script>
    
    <!-- Load Google Maps API -->
    <script async defer 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBoY49XH3vIuWR0ekN7MRk3n8gJstxdb3w&libraries=geometry&callback=initMap&loading=async">
    </script>
</body>
</html>
